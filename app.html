<!DOCTYPE html>
<html {{ HTML_ATTRS }}>
  <head {{ HEAD_ATTRS }}>
    {{HEAD}}
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <script
      async="async"
      src="https://www.google.com/adsense/search/ads.js"
    ></script>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6430486603399192"
      crossorigin="anonymous"
    ></script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-98PTT13FKE"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())
      gtag('config', 'G-98PTT13FKE')
    </script>
    <script>
      ;(function (w, d, s, l, i) {
        w[l] = w[l] || []
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' })
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : ''
        j.async = true
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl
        f.parentNode.insertBefore(j, f)
      })(window, document, 'script', 'dataLayer', 'GTM-PPR73G6')
    </script>
    <script
      async
      src="https://fundingchoicesmessages.google.com/i/pub-6430486603399192?ers=1"
      nonce="_Apilt2Pk2SKFMbI4-3ArA"
    ></script>
    <script nonce="_Apilt2Pk2SKFMbI4-3ArA">
      ;(function () {
        function signalGooglefcPresent() {
          if (!window.frames['googlefcPresent']) {
            if (document.body) {
              const iframe = document.createElement('iframe')
              iframe.style =
                'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'
              iframe.style.display = 'none'
              iframe.name = 'googlefcPresent'
              document.body.appendChild(iframe)
            } else {
              setTimeout(signalGooglefcPresent, 0)
            }
          }
        }
        signalGooglefcPresent()
      })()
    </script>
    <script type="text/javascript" charset="utf-8">
      ;(function (g, o) {
        ;(g[o] =
          g[o] ||
          function () {
            ;(g[o]['q'] = g[o]['q'] || []).push(arguments)
          }),
          (g[o]['t'] = 1 * new Date())
      })(window, '_googCsa')
    </script>
  </head>
  <body {{ BODY_ATTRS }}>
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-PPR73G6"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    {{ APP }}
    <script>
      window.onlyOne = false
      window.addEventListener('beforeunload', () => {
        let index = window.dataLayer.findIndex(
          ({ event }) => event === 'gtm.linkClick'
        )
        if (index !== -1 && !window.onlyOne) {
          let elementUrl = window.dataLayer[index]['gtm.elementUrl']
          let pageChangeNum = localStorage.getItem('pageChangeNum')
          let pageChangeHomeNum = localStorage.getItem('pageChangeHomeNum')
          let unloadNum = localStorage.getItem('unloadNum')
          if (window.i_like_it === 1) {
            dataLayer.push({
              event: 'justdoit',
            })
            if (unloadNum && Number(unloadNum) > 0) {
              dataLayer.push({
                event: 'justdoitUnloadNum',
              })
              localStorage.setItem('unloadNum', JSON.stringify(0))
            }
          } else {
            dataLayer.push({
              event: 'pageChange',
            })
            if (unloadNum) {
              let num = Number(unloadNum) + 1
              localStorage.setItem('unloadNum', JSON.stringify(num))
            } else {
              localStorage.setItem('unloadNum', JSON.stringify(1))
            }
          }
          if (pageChangeHomeNum) {
            if (pageChangeHomeNum < 2) {
              let num = Number(pageChangeHomeNum) + 1
              localStorage.setItem('pageChangeHomeNum', JSON.stringify(num))
            } else {
              localStorage.setItem('pageChangeHomeNum', JSON.stringify(0))
              dataLayer.push({
                event: 'product-pages-home-3',
              })
            }
          } else {
            localStorage.setItem('pageChangeHomeNum', JSON.stringify(1))
          }
          if (
            ![
              'https://www.seekastrology.com/',
              'https://seekastrology.com/',
            ].includes(elementUrl)
          ) {
            if (pageChangeNum) {
              if (pageChangeNum < 2) {
                let num = Number(pageChangeNum) + 1
                localStorage.setItem('pageChangeNum', JSON.stringify(num))
              } else {
                localStorage.setItem('pageChangeNum', JSON.stringify(0))
                dataLayer.push({
                  event: 'product-pages-3',
                })
              }
            } else {
              localStorage.setItem('pageChangeNum', JSON.stringify(1))
            }
          }
          window.onlyOne = true
        }
      })
      window.addEventListener('hashchange', () => {
        if (window.location.hash == '#google_vignette') {
          let hashchangeNum = localStorage.getItem('hashchangeNum') || 0
          hashchangeNum = Number(hashchangeNum) + 1
          localStorage.setItem('hashchangeNum', hashchangeNum)
          window.i_like_it = 1
          dataLayer.push({
            event: 'adsChange',
          })
          let numot = localStorage.getItem('numot')
          if (numot) {
            if (Number(numot) > 1) {
              dataLayer.push({
                event: 'numot3',
              })
              localStorage.setItem('numot', JSON.stringify(3))
            } else {
              dataLayer.push({
                event: 'numot2',
              })
              localStorage.setItem('numot', JSON.stringify(2))
            }
          } else {
            dataLayer.push({
              event: 'numot1',
            })
            localStorage.setItem('numot', JSON.stringify(1))
          }
        }
      })
      window.addEventListener('message', (e) => {
        if (
          e.data ===
            '{"eventType":"adClosed","result":{"status":1},"googMsgType":"fullscreen"}' &&
          e.origin === 'https://googleads.g.doubleclick.net'
        ) {
          window.i_like_it = 0
        }
      })
      window.addEventListener('blur', () => {
        let unloadNum = localStorage.getItem('unloadNum')
        const activeElement = document.activeElement
        const src = activeElement.getAttribute('src')
        if (
          src &&
          src.indexOf('googleads.g.doubleclick.net/pagead/ads?') !== -1
        ) {
          const parentIns = activeElement.closest('ins')
          let adStatus = 'unfilled'
          if (parentIns) {
            adStatus = parentIns.getAttribute('data-ad-status')
          }
          if (adStatus == 'filled') {
            dataLayer.push({
              event: 'sitePageAD',
            })
            if (unloadNum && Number(unloadNum) > 1) {
              dataLayer.push({
                event: 'sitePageADUnloadNum',
              })
              localStorage.setItem('unloadNum', JSON.stringify(0))
            }
          }
        } else if (
          src &&
          src.indexOf('googleads.g.doubleclick.net/pagead/html/') !== -1
        ) {
          if (src.indexOf('btvi=') !== -1) {
            dataLayer.push({
              event: 'siteAnchoringAD',
            })
            if (unloadNum && Number(unloadNum) > 1) {
              dataLayer.push({
                event: 'siteAnchoringADUnloadNum',
              })
              localStorage.setItem('unloadNum', JSON.stringify(0))
            }
          } else {
            dataLayer.push({
              event: 'siteAlternateAD',
            })
          }
        }
      })
    </script>
  </body>
</html>
